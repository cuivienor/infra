[Unit]
Description=Wishlist - Self-hosted gift registry
Documentation=https://github.com/cmintey/wishlist
After=network-online.target
Wants=network-online.target

[Service]
Type=simple
User={{ wishlist_user }}
Group={{ wishlist_group }}
WorkingDirectory={{ wishlist_home }}/repo
EnvironmentFile=/etc/default/wishlist

# Run migrations before starting app
ExecStartPre=/usr/bin/pnpm prisma migrate deploy
ExecStartPre=/usr/bin/pnpm prisma db seed
ExecStartPre=/bin/sh -c 'pnpm db:patch || true'

# Start application
ExecStart=/usr/bin/node build

# Process management
Restart=on-failure
RestartSec=10s
KillMode=mixed
KillSignal=SIGTERM
TimeoutStopSec=30s

# Security hardening
NoNewPrivileges=true
PrivateTmp=true
ProtectSystem=strict
ProtectHome=true
ReadWritePaths={{ wishlist_home }}

# Resource limits
MemoryMax=1G
CPUQuota=150%

[Install]
WantedBy=multi-user.target
