---
# Quick test playbook to verify Ansible can connect to Raspberry Pis

- name: Test Raspberry Pi connectivity
  hosts: raspberry_pis
  become: true
  gather_facts: true

  tasks:
    - name: Ping test
      ansible.builtin.ping:

    - name: Display current OS information
      ansible.builtin.debug:
        msg: |
          Hostname: {{ ansible_facts['hostname'] }}
          OS: {{ ansible_facts['distribution'] }} {{ ansible_facts['distribution_version'] }} ({{ ansible_facts['distribution_release'] }})
          Kernel: {{ ansible_facts['kernel'] }}
          Architecture: {{ ansible_facts['architecture'] }}
          IP: {{ ansible_facts['default_ipv4'].address }}
          Memory: {{ ansible_facts['memtotal_mb'] }}MB
          Storage: {{ current_storage }}
          Model: {{ pi_model }}

    - name: Check disk space
      ansible.builtin.shell: df -h / | tail -1
      register: disk_space
      changed_when: false

    - name: Display disk space
      ansible.builtin.debug:
        var: disk_space.stdout

    - name: Check uptime
      ansible.builtin.shell: uptime -p
      register: uptime_output
      changed_when: false

    - name: Display uptime
      ansible.builtin.debug:
        msg: "Uptime: {{ uptime_output.stdout }}"

    - name: Check temperature
      ansible.builtin.shell: vcgencmd measure_temp
      register: temp_output
      changed_when: false
      failed_when: false

    - name: Display temperature
      ansible.builtin.debug:
        msg: "{{ temp_output.stdout if temp_output.rc == 0 else 'Temperature check not available' }}"
